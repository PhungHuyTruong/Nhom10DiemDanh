@model IEnumerable<API.Data.CaHoc>
@{
    Layout = "~/Views/Shared/CanBoDaoTaoLayout.cshtml";
    string tenCaHoc = Context.Request.Query["tenCaHoc"];
    string trangThai = Context.Request.Query["trangThai"];
    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
}

<h2 class="mb-4 text-white">Quản lý ca học</h2>

<!-- Bộ lọc -->
<form method="get" class="row mb-4 g-2 align-items-end bg-white p-3 rounded shadow-sm">
    <div class="col-md-4">
        <label for="tenCaHoc" class="form-label">Tìm theo tên ca học</label>
        <input type="text" name="tenCaHoc" class="form-control" value="@tenCaHoc" placeholder="Nhập tên ca học" />
    </div>
    <div class="col-md-3">
        <label for="trangThai" class="form-label">Trạng thái</label>
        <select name="trangThai" class="form-select">
    @Html.Raw($"<option value=\"\" {(string.IsNullOrEmpty(trangThai) ? "selected" : "")}>Tất cả</option>")
    @Html.Raw($"<option value=\"1\" {(trangThai == "1" ? "selected" : "")}>Hoạt động</option>")
    @Html.Raw($"<option value=\"0\" {(trangThai == "0" ? "selected" : "")}>Không hoạt động</option>")
</select>
    </div>
    <div class="col-md-5 d-flex gap-2">
        <button type="submit" class="btn btn-primary">Lọc</button>
        <a href="@Url.Action("Index")" class="btn btn-outline-secondary">Hủy lọc</a>
        <a class="btn btn-success ms-auto" asp-action="Create">Thêm ca học mới</a>
    </div>
</form>

<!-- Bảng danh sách -->
<div class="bg-white p-3 rounded shadow-sm">
    <table class="table table-hover table-bordered align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th>Tên ca học</th>
                <th>Thời gian bắt đầu</th>
                <th>Thời gian kết thúc</th>
                <th>Trạng thái</th>
                <th style="width: 220px;">Hành động</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="5" class="text-center">Không tìm thấy ca học phù hợp.</td>
                </tr>
            }
            else
            {
                foreach (var item in Model)
                {
                    <tr>
                        <td>@(string.IsNullOrWhiteSpace(item.TenCaHoc) ? "(Không có tên)" : item.TenCaHoc)</td>
                        <td>@item.ThoiGianBatDau?.ToString(@"hh\:mm")</td>
                        <td>@item.ThoiGianKetThuc?.ToString(@"hh\:mm")</td>
                        <td>
                            <span class="badge @(item.TrangThai == 1 ? "bg-success" : "bg-secondary")">
                                @(item.TrangThai == 1 ? "Hoạt động" : "Không hoạt động")
                            </span>
                        </td>
                        <td class="text-nowrap">
                            <a asp-action="Details" asp-route-id="@item.IdCaHoc" class="btn btn-sm btn-info text-white me-1"><i class="bi bi-eye-fill me-1"></i> Chi tiết</a>
                            <a asp-action="Edit" asp-route-id="@item.IdCaHoc" class="btn btn-sm btn-primary me-1"><i class="bi bi-pencil-fill me-1"></i> Sửa</a>
                            <form asp-action="Delete" asp-route-id="@item.IdCaHoc" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Bạn có chắc muốn xóa ca học này?')">
                                    <i class="bi bi-trash-fill me-1"></i> Xoá
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<!-- PHÂN TRANG -->
@if (totalPages > 1)
{
    <nav class="mt-3">
        <ul class="pagination justify-content-center">
            @for (int i = 1; i <= totalPages; i++)
            {
                var queryParams = new Dictionary<string, string>
                {
                    { "tenCaHoc", tenCaHoc ?? "" },
                    { "trangThai", trangThai ?? "" },
                    { "page", i.ToString() }
                };
                var url = Url.Action("Index") + "?" + string.Join("&", queryParams.Where(kv => !string.IsNullOrWhiteSpace(kv.Value)).Select(kv => $"{kv.Key}={kv.Value}"));

                <li class="page-item @(i == currentPage ? "active" : "")">
                    <a class="page-link" href="@url">@i</a>
                </li>
            }
        </ul>
    </nav>
}
